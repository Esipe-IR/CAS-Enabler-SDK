"use strict";var RCV_TOKEN="rcv::token";var GRAPH_URL="/graphql";var METHOD={POST:"POST",GET:"GET"};var UPEMSDK=function(){function UPEMSDK(userConfig){var defaultConfig={baseURL:"https://perso-etudiant.u-pem.fr/~vrasquie/api",debug:false};var c=Object.assign(defaultConfig,userConfig);var self=this;this.config=Object.freeze(c);this.callback={};window.addEventListener("message",function(event){var msg=event.data;if(!msg.type){return self.log("<= EventMessage (RcvError - No Type)",event)}if(msg.src==document.URL){return self.log("=> EventMessage (Send)",msg)}self.log("<= Event Message (RCV)",msg);if(typeof self.callback[msg.type]==="function"){return self.callback[msg.type](msg.data)}});this.log("INIT",this)}UPEMSDK.prototype.log=function(action,extra){if(this.config.debug){console.log("UPEM SDK"," - "+action+" - ",extra)}};UPEMSDK.prototype.call=function(config,callback){var xhr=new XMLHttpRequest;xhr.open(config.method,config.url,true);xhr.setRequestHeader("Content-type","application/x-www-form-urlencoded");xhr.responseType="json";var self=this;xhr.onreadystatechange=function(){if(xhr.readyState==4&&xhr.status==200){self.log("CALL",xhr.response);callback(xhr.response.data,xhr.response.errors)}};xhr.send(config.params)};UPEMSDK.prototype.getParams=function(query,variables){return JSON.stringify({query:query,variables:variables})};UPEMSDK.prototype.onToken=function(callback){if(typeof callback!=="function")throw new Error("callback should be a function");this.callback[RCV_TOKEN]=callback};UPEMSDK.prototype.getProjects=function(callback){var url=this.config.baseURL+GRAPH_URL;var graph="query {\n      projects {\n        id\n        name\n      }\n    }";var params=this.getParams(graph);this.call({url:url,method:METHOD.POST,params:params},callback)};UPEMSDK.prototype.getResources=function(projectId,callback){var url=this.config.baseURL+GRAPH_URL;var graph="query($projectId: Int!) {\n      resources(projectId: $projectId) {\n        id\n        name\n      }\n    }";var params=this.getParams(graph,{projectId:projectId});this.call({url:url,method:METHOD.POST,params:params},callback)};UPEMSDK.prototype.getResource=function(projectId,id,callback){var url=this.config.baseURL+GRAPH_URL;var graph="query($projectId: Int!, $id: Int!) {\n      resource(projectId: $projectId, id: $id) {\n        id\n        name\n        category\n      }\n    }";var params=this.getParams(graph,{projectId:projectId,id:id});this.call({url:url,method:METHOD.POST,params:params},callback)};UPEMSDK.prototype.getResourceWithEvents=function(projectId,id,startDate,endDate,callback){var url=this.config.baseURL+GRAPH_URL;var graph="query($projectId: Int!, $id: Int!, $startDate: String!, $endDate: String!) {\n      resource(projectId: $projectId, id: $id) {\n        id\n        name\n        category\n        events(projectId: $projectId, startDate: $startDate, endDate: $endDate) {\n          id\n          name\n          startHour\n          endHour\n          instructor\n          classroom\n          class\n          date\n          color\n        }\n      }\n    }";var params=this.getParams(graph,{projectId:projectId,id:id,startDate:startDate,endDate:endDate});this.call({url:url,method:METHOD.POST,params:params},callback)};UPEMSDK.prototype.getEvents=function(projectId,resource,startDate,endDate,callback){var url=this.config.baseURL+GRAPH_URL;var graph="query(\n      $projectId: Int!,\n      $resource: Int!,\n      $startDate: String!,\n      $endDate: String!\n    ) {\n      events(\n        projectId: $projectId,\n        resources: $resource,\n        startDate: $startDate,\n        endDate: $endDate\n      ) {\n        id\n        name\n        startHour\n        endHour\n        instructor\n        classroom\n        class\n        date\n        color\n      }\n    }";var params=this.getParams(graph,{projectId:projectId,resource:resource,startDate:startDate,endDate:endDate});this.call({url:url,method:METHOD.POST,params:params},callback)};UPEMSDK.prototype.getUser=function(callback){var url=this.config.baseURL+GRAPH_URL;var graph="query {\n      user {\n        uid\n      }\n    }";var params=this.getParams(graph);this.call({url:url,method:METHOD.POST,params:params,headers:{}},callback)};UPEMSDK.prototype.getGraph=function(graph,variables,callback){var url=this.config.baseURL+GRAPH_URL;var params=this.getParams(graph,variables);this.call({url:url,method:METHOD.POST,params:params},callback)};return UPEMSDK}();exports.UPEMSDK=UPEMSDK;
