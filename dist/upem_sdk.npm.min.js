"use strict";exports.CORE="UPEM-Core";exports.VAULT="UPEM-Vault";var RCV_TOKEN="rcv::token";var ASK_CONNECT="ask::connect";var ASK_RESET="ask::reset";var SDK=function(){function SDK(userConfig){var defaultConfig={baseURL:"https://perso-etudiant.u-pem.fr/~vrasquie/core",scope:exports.CORE,debug:false};var c=Object.assign(defaultConfig,userConfig);this._c=Object.freeze(c);var self=this;this._callback={};window.addEventListener("message",function(event){var msg=event.data;if(!msg.type){return self._log("<= EventMessage (RcvError - No Type)",event)}if(msg.scope!==self._c.scope){return self._log("<= EventMessage (RcvError - Bad scopre)",event)}if(msg.src==document.URL){return self._log("=> EventMessage (Send)",msg)}self._log("<= Event Message (RCV)",msg);if(typeof self._callback[msg.type]==="function"){return self._callback[msg.type](msg.data)}});this._log("INIT",this)}SDK.prototype._log=function(action,extra){if(this._c.debug){console.log("UPEM SDK"," - "+action+" - ",extra)}};SDK.prototype._createMsg=function(type,data,code,scope,src,error){return{type:type,data:data?data:null,code:code?code:0,scope:scope?scope:this._c.scope,src:src?src:this._c.baseURL,error:error?error:null}};SDK.prototype._post=function(msg){window.postMessage(msg,"*")};SDK.prototype.onToken=function(callback){if(typeof callback!=="function")throw new Error("callback should be a function");this._callback[RCV_TOKEN]=callback};SDK.prototype.resetVault=function(){this._post(this._createMsg(ASK_RESET))};SDK.prototype.askConnect=function(){this._post(this._createMsg(ASK_CONNECT))};return SDK}();exports.SDK=SDK;
